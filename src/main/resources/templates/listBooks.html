<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="">
<head>
    <meta charset="utf-8">
    <title>Book Search</title>
    <style>
        body { width: 800px; margin: auto; font-family: Arial, sans-serif; }
        h1 { text-align: center; }
        form { margin-top: 20px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="text"], input[type="number"] {
            width: 100%; padding: 8px; margin-top: 4px;
        }
        input[type="submit"] {
            margin-top: 15px; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 5px;
        }
        .book-option { border: 1px solid #ccc; border-radius: 5px; padding: 10px; margin: 5px 0; }
    </style>
</head>
<body>
<h1>Book Reservation Search</h1>

<!-- Search Form -->
<form action="/books" method="GET">
    <label for="title">Book name (partial or full):</label>
    <input type="text" id="title" name="title" th:value="${title}">

    <label for="minRating">Minimum rating:</label>
    <input type="number" id="minRating" name="minRating" step="0.1" min="0" max="5" th:value="${minRating}">

    <input type="submit" value="Search">
</form>

<!-- Search error or no books -->
<div th:if="${books == null}">
    <p>Please fill in both fields and click <strong>Search</strong> to see matching books.</p>
</div>

<div th:if="${books != null}">
    <h2 th:if="${#lists.isEmpty(books)}">No books match your search.</h2>

    <!-- Book selection form -->
    <form th:if="${!#lists.isEmpty(books)}" action="/bookReservation" method="POST">
        <fieldset>
            <legend>Choose a book:</legend>
            <th:block th:each="book : ${books}">
                <label class="book-option">
                    <input type="radio" name="bookTitle" th:value="${book.title}" required>
                    Title: <span th:text="${book.title}"></span>,
                    Genre: <span th:text="${book.genre}"></span>,
                    Rating: <span th:text="${book.averageRating}"></span>
                </label>
            </th:block>
        </fieldset>

        <h3>Enter your information:</h3>
        <label>Your Name:</label>
        <input type="text" name="readerName" required>

        <label>Your Address:</label>
        <input type="text" name="readerAddress" required>

        <label>Number of copies:</label>
        <input type="number" name="numberOfCopies" min="1" max="10" required>

        <br>
        <input type="submit" value="Reserve Book">
    </form>

    <!-- Recently viewed books -->
    <div th:if="${!#lists.isEmpty(recentBooks)}">
        <fieldset>
            <legend>Recently viewed:</legend>
            <th:block th:each="book : ${recentBooks}">
                <label>
                    <input type="radio" name="bookTitle" th:value="${book}">
                    <span th:text="${book}"></span>
                </label>
            </th:block>
        </fieldset>
    </div>
    <div th:if="${#lists.isEmpty(recentBooks)}">
        <p>No recently viewed books yet.</p>
    </div>

</div>

</body>
</html>
